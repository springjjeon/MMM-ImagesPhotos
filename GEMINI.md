# MMM-ImagesPhotos 개발/유지보수 지침

이 문서는 `MMM-ImagesPhotos` 모듈의 개발/유지보수 지침을 담습니다. 모듈별로 고유 규칙을 기록하고 PR로 변경을 관리하세요.

*마지막 수정일: 2026-01-03*

## 목적
- 모듈의 일관된 코드 스타일과 동작 규칙을 제공하여 유지보수를 쉽게 합니다.
- 사진 효과(전환, 배경색, 애니메이션) 관련 결정과 성능 고려사항을 중앙화합니다.

## 범위
- 이 파일은 `modules/MMM-ImagesPhotos` 디렉터리 내부의 변경에 적용됩니다.

## 코드 스타일
- 프로젝트 전체의 ESLint/Prettier 설정을 따릅니다 (루트의 `eslint.config.mjs`, `prettier.config.mjs`).
- JavaScript: ES2018+ 규칙, `const`/`let` 사용, 함수명/변수명은 camelCase.
- CSS: 모듈 scoped 클래스(`.mmip-...`)를 사용하여 전역 스타일 충돌을 피합니다.

## 효과 규칙
- **전환 순서**: 검정(black) → 페이드인 → 표시 → 페이드아웃.
- **효과 목록**: `still` (정지), `zoom`, `pan` (상/하/좌/우/대각선), `zoom-pan` 등 다양한 효과를 `config.js`의 `imageEffects` 배열을 통해 설정할 수 있습니다.
- **애니메이션 속도**: 모든 애니메이션 효과의 지속 시간(duration)은 `20초 ~ 40초` 사이의 임의 값으로 설정되어 다양한 속도감을 제공합니다.
- **이동(Pan) 및 줌(Zoom) 규칙**: 과도한 움직임을 방지하기 위해, 모든 이동 및 확대 효과는 15%(`scale(1.15)` 또는 `translate(15%)`)를 초과하지 않도록 제한됩니다.

### 얼굴 인식 팬-줌(Pan-Zoom) 효과
- **적용 확률**: 사진에서 얼굴이 인식되었을 경우, `40%`의 확률로 얼굴 줌 효과가 적용됩니다. (나머지 60%는 일반 효과 적용)
- **효과 선택**: 얼굴 줌 효과 적용 시, 줌인(pan-zoom)과 줌아웃 중 하나가 무작위로 선택됩니다.
- **대상 지정**: 사진에 여러 얼굴이 있을 경우, 효과의 중심이 될 얼굴 하나를 무작위로 선택합니다.
- **줌인 시점**: 줌인 시, 선택된 얼굴이 화면의 **가로 중앙, 세로 30% 지점**으로 부드럽게 이동하며 확대되어 인물에 시선이 집중되도록 합니다. 이 동적 애니메이션은 JavaScript를 통해 생성됩니다.
- **줌아웃 시점**: 줌아웃 시에는 얼굴을 중심으로 화면이 단순 축소됩니다.

## EXIF 정보 표시 기능
사진의 EXIF 정보를 읽어와 화면 우측 하단에 표시하는 기능입니다. 표시되는 정보는 다음과 같습니다.
-   💾 **파일명**
-   🗓️ **촬영일**: `YYYY-MM-DD HH:MM` 형식
-   📍 **위치 (GPS)**: 리버스 지오코딩을 통해 주소로 변환
-   📷 **카메라 모델**
-   ⚙️ **상세 촬영 정보**: 초점거리, 조리개, 셔터속도, ISO
-   ✨ **사진 효과**: 현재 적용된 애니메이션 효과 이름 및 감지된 얼굴 수 (예: `ip-face-pan-zoom-in (1👤)`)

## 성능 고려사항
- **"Next Up" 데이터 로딩**: 모듈은 초기 로딩 속도 향상을 위해 "Next Up" 패턴을 사용합니다.
  1. 시작 시, 전체 사진 목록(경로)만 빠르게 가져옵니다.
  2. 현재 사진을 표시하는 동안, 다음에 표시될 사진의 메타데이터(EXIF, GPS, 얼굴)를 백그라운드에서 미리 요청하고 처리합니다.
  3. 이 방식을 통해 초기 로딩 지연 없이 슬라이드쇼를 즉시 시작하고, 각 사진이 표시될 때 필요한 모든 정보를 사용할 수 있습니다.
- **애니메이션**: `will-change`, `transform`, `opacity`를 활용하여 GPU 가속을 유도하고 레이어 생성 비용을 줄입니다.
- **저사양 환경**: Raspberry Pi 등 저사양 환경에서는 `config.js`에서 효과 개수를 줄이거나 `updateInterval`을 늘려 부하를 조절하는 것이 좋습니다.

## 테스트 및 디버깅
- **상태 관리**: "Next Up" 아키텍처에서 렌더링 간 데이터가 섞이는 문제를 방지하기 위해, `getDom()` 함수에서 현재 표시할 사진 객체(`currentPhoto`)를 깊은 복사(`JSON.parse(JSON.stringify(...))`)하여 사용합니다. 이는 잠재적인 Race Condition을 방지하는 핵심적인 방어 로직입니다.
- **로그**: `config.js`에서 `debugToConsole: true`로 설정 시, 데이터 흐름과 상태 변화에 대한 상세한 로그를 브라우저 개발자 콘솔에서 확인할 수 있습니다.
- **CORS**: 외부 URL 이미지 사용 시, 브라우저 개발자 도구의 콘솔에서 `cross-origin` 관련 오류가 발생하는지 확인해야 합니다.

## Git / 커밋 규칙
- 브랜치: `feature/<짧은-설명>`, `fix/<이슈-번호>-desc`.
- 커밋 메시지: `type(scope): subject` 스타일 권장 (예: `feat(images): add average-color background`).
- 작은 단위의 커밋으로 가독성을 높일 것.

## 참고
- 프로젝트 루트의 ESLint/Prettier 설정을 따르세요.
- 관련 파일: `MMM-ImagesPhotos.js`, `MMM-ImagesPhotos.css`, `node_helper.js`.

---
*Vibe-coding과 Gemini가 함께 생성했습니다*